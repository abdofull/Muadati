<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تسجيل الدخول - نظام معداتي ليبيا</title>
  <meta name="description" content="تسجيل الدخول إلى منصة معداتي - أكبر منصة لتأجير المعدات في ليبيا">
  
  <!-- Styles -->
  <link rel="stylesheet" href="/css/main.css">
  
  <!-- FontAwesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <div class="hero" style="min-height: 100vh; display: flex; align-items: center;">
    <div class="container">
      <div style="max-width: 500px; margin: 0 auto;">
        <!-- Logo/Brand -->
        <div class="text-center mb-8">
          <a href="/index.html" class="navbar-brand" style="justify-content: center; margin-bottom: var(--spacing-4);">
            <i class="fas fa-tools"></i>
            <span>نظام معداتي</span>
          </a>
          <p style="color: rgba(255,255,255,0.9); font-size: var(--font-size-lg);">
            سجل دخولك للوصول إلى حسابك
          </p>
        </div>

        <!-- Login Form Card -->
        <div class="card">
          <div class="card-body" style="padding: var(--spacing-8);">
            <h2 class="text-center mb-6" style="color: var(--color-primary);">تسجيل الدخول</h2>
            
            <form id="loginForm">
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-envelope ml-2"></i>
                  البريد الإلكتروني أو الهاتف
                </label>
                <input 
                  type="text" 
                  id="emailOrPhone" 
                  class="form-control" 
                  placeholder="أدخل البريد الإلكتروني أو رقم الهاتف"
                  required
                >
              </div>

              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-lock ml-2"></i>
                  كلمة المرور
                </label>
                <input 
                  type="password" 
                  id="password" 
                  class="form-control" 
                  placeholder="أدخل كلمة المرور"
                  required
                >
              </div>

              <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
                <i class="fas fa-sign-in-alt"></i>
                دخول
              </button>
            </form>

            <div class="text-center mt-6">
              <p style="color: var(--color-gray-600);">
                ليس لديك حساب؟
                <a href="/register.html" style="color: var(--color-accent); font-weight: 700;">
                  سجل الآن
                </a>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { api, setToken, setUser, showError, showSuccess, showLoading, requireGuest } from './js/utils.js';
    
    // Redirect if already authenticated
    requireGuest();

    const loginForm = document.getElementById('loginForm');

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const emailOrPhone = document.getElementById('emailOrPhone').value.trim();
      const password = document.getElementById('password').value;

      if (!emailOrPhone || !password) {
        showError('الرجاء إدخال جميع الحقول المطلوبة');
        return;
      }

      try {
        showLoading('جاري تسجيل الدخول...');

        const response = await api.post('/auth/login', {
          emailOrPhone,
          password
        });

        if (response.success) {
          setToken(response.data.token);
          setUser(response.data.user);

          await showSuccess(response.message || 'تم تسجيل الدخول بنجاح');

          // Redirect based on role
          if (response.data.user.role === 'owner') {
            window.location.href = '/owner-dashboard.html';
          } else {
            window.location.href = '/index.html';
          }
        }
      } catch (error) {
        showError(error.message || 'حدث خطأ أثناء تسجيل الدخول');
      }
    });
  </script>
</body>
</html>
