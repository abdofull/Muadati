<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إنشاء حساب - نظام معداتي ليبيا</title>
    <meta name="description" content="إنشاء حساب جديد في منصة معداتي - أكبر منصة لتأجير المعدات في ليبيا">

    <!-- Styles -->
    <link rel="stylesheet" href="/css/main.css">

    <!-- FontAwesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
    <div class="hero" style="min-height: 100vh; display: flex; align-items: center; padding: var(--spacing-8) 0;">
        <div class="container">
            <div style="max-width: 600px; margin: 0 auto;">
                <!-- Logo/Brand -->
                <div class="text-center mb-8">
                    <a href="/home.html" class="navbar-brand"
                        style="justify-content: center; margin-bottom: var(--spacing-4);">
                        <i class="fas fa-tools"></i>
                        <span>نظام معداتي</span>
                    </a>
                    <p style="color: rgba(255,255,255,0.9); font-size: var(--font-size-lg);">
                        انضم إلى أكبر منصة للمعدات في ليبيا
                    </p>
                </div>

                <!-- Register Form Card -->
                <div class="card">
                    <div class="card-body" style="padding: var(--spacing-8);">
                        <h2 class="text-center mb-6" style="color: var(--color-primary);">إنشاء حساب جديد</h2>

                        <form id="registerForm">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-user ml-2"></i>
                                    الاسم الكامل
                                </label>
                                <input type="text" id="name" class="form-control" placeholder="أدخل اسمك الكامل"
                                    required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-envelope ml-2"></i>
                                    البريد الإلكتروني
                                </label>
                                <input type="email" id="email" class="form-control" placeholder="example@email.com"
                                    required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-phone ml-2"></i>
                                    رقم الهاتف
                                </label>
                                <input type="tel" id="phone" class="form-control" placeholder="0911234567"
                                    pattern="(091|092|093|094|095)\d{7}" required>
                                <small class="form-error" style="color: var(--color-gray-500);">
                                    أدخل رقم هاتف ليبي صحيح (يبدأ بـ 091، 092، 093، 094، أو 095)
                                </small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-map-marker-alt ml-2"></i>
                                    المدينة
                                </label>
                                <select id="city" class="form-control" required>
                                    <option value="">اختر المدينة</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-user-tag ml-2"></i>
                                    نوع الحساب
                                </label>
                                <select id="role" class="form-control" required>
                                    <option value="">اختر نوع الحساب</option>
                                    <option value="customer">عميل (أبحث عن معدات)</option>
                                    <option value="owner">مالك معدات (أملك معدات للتأجير)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-lock ml-2"></i>
                                    كلمة المرور
                                </label>
                                <input type="password" id="password" class="form-control"
                                    placeholder="أدخل كلمة المرور (6 أحرف على الأقل)" minlength="6" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-lock ml-2"></i>
                                    تأكيد كلمة المرور
                                </label>
                                <input type="password" id="confirmPassword" class="form-control"
                                    placeholder="أعد إدخال كلمة المرور" minlength="6" required>
                            </div>

                            <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
                                <i class="fas fa-user-plus"></i>
                                إنشاء حساب
                            </button>
                        </form>

                        <div class="text-center mt-6">
                            <p style="color: var(--color-gray-600);">
                                لديك حساب بالفعل؟
                                <a href="/login.html" style="color: var(--color-accent); font-weight: 700;">
                                    سجل دخولك
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { LIBYAN_CITIES } from './js/config.js';
        import { api, setToken, setUser, showError, showSuccess, showLoading, requireGuest } from './js/utils.js';

        // Redirect if already authenticated
        requireGuest();

        // Populate cities
        const citySelect = document.getElementById('city');
        LIBYAN_CITIES.forEach(city => {
            const option = document.createElement('option');
            option.value = city;
            option.textContent = city;
            citySelect.appendChild(option);
        });

        const registerForm = document.getElementById('registerForm');

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const city = document.getElementById('city').value;
            const role = document.getElementById('role').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Validation
            if (!name || !email || !phone || !city || !role || !password) {
                showError('الرجاء إدخال جميع الحقول المطلوبة');
                return;
            }

            if (password !== confirmPassword) {
                showError('كلمات المرور غير متطابقة');
                return;
            }

            if (password.length < 6) {
                showError('كلمة المرور يجب أن تكون 6 أحرف على الأقل');
                return;
            }

            const phoneRegex = /^(091|092|093|094|095)\d{7}$/;
            if (!phoneRegex.test(phone)) {
                showError('رقم الهاتف غير صحيح. يجب أن يبدأ بـ 091، 092، 093، 094، أو 095');
                return;
            }

            try {
                showLoading('جاري إنشاء الحساب...');

                const response = await api.post('/auth/register', {
                    name,
                    email,
                    phone,
                    city,
                    role,
                    password
                });

                if (response.success) {
                    setToken(response.data.token);
                    setUser(response.data.user);

                    await showSuccess(response.message || 'تم إنشاء الحساب بنجاح');

                    // Redirect based on role
                    if (response.data.user.role === 'owner') {
                        window.location.href = '/owner-dashboard.html';
                    } else {
                        window.location.href = '/home.html';
                    }
                }
            } catch (error) {
                showError(error.message || 'حدث خطأ أثناء إنشاء الحساب');
            }
        });
    </script>
</body>

</html>